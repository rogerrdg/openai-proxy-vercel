
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Teste Streaming OpenAI</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #output { white-space: pre-wrap; background: #eee; padding: 10px; border-radius: 5px; min-height: 50px; }
  </style>
</head>
<body>

  <h1>Teste Streaming OpenAI</h1>
  <textarea id="userMessage" rows="3" cols="50" placeholder="Digite sua pergunta..."></textarea><br>
  <button onclick="sendMessage()">Enviar</button>

  <h2>Resposta:</h2>
  <div id="output"></div>

  <script>
    async function sendMessage() {
      const output = document.getElementById('output');
      const userMessage = document.getElementById('userMessage').value;
      output.innerHTML = '';

      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          messages: [
            { role: 'system', content: 'Você é um assistente em português.' },
            { role: 'user', content: userMessage }
          ]
        })
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder();

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = line.slice(6);
            if (data === '[DONE]') return;

            try {
              const parsed = JSON.parse(data);
              const content = parsed.choices?.[0]?.delta?.content;
              if (content) {
                output.innerHTML += content;
              }
            } catch (e) {}
          }
        }
      }
    }
  </script>

</body>
</html>
